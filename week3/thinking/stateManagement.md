## React에서 상태관리는 왜 필요한가?

리액트는 단방향의 데이터 흐름을 가진다.

즉, 상위 컴포넌트의 state를 하위 컴포넌트의 props로 내려주고, 그 props를 또 다시 하위 컴포넌트에 넘겨주는 방식으로 데이터를 전달한다.

이 과정에서 A 컴포넌트의 동작 자체 필요한 props가 아니더라도 B 컴포넌트에게 전달하기 위한 목적만으로 A 컴포넌트는 상위 컴포넌트의 state를 props로 받아와야하는 상황이 발생할 수 있다.

이러한 상황을 `Props Drilling`이라고 부른다.

`props Drilling`이 항상 문제가 되는 것은 아니지만 애플리케이션이 성장하며 여러 계층의 컴포넌트가 만들어진 상태라면 props가 전달되며 불필요한 리레더링이 발생하여 UX를 불편하게 만들고, 성능 이슈도 발생시킬 수 있다.

또한 A-B-C 컴포넌트 순으로 props를 전달했는데 B-C에서 전달하는 props의 이름을 변경한다면 C에서 문제가 생겼을 때 해당 Props가 어디에서부터 온 건지 추적하기가 힘들어지기도 한다.

그래서 context API와 같은 내장 함수 또는 redux, recoil 등의 상태관리를 하게 된 것이다.

---

## 관리 해야 하는 상태에 대한 기준은 무엇인가?

우리는 크게 상태 관리의 기준을 두 가지로 나누어볼 수 있겠다.

1. 지역 상태

쉽게 말하면 컴포넌트가 필요로 하는 상태이다.

변경될 때마다 컴포넌트와 그 자식 컴포넌트의 리렌더링을 일으키기에 우리는 useEffect, useMemo, React.memo, useCallback 등으로 지역 상태를 관리하여 렌더링 최적화를 꾀하기도 한다.

2. 전역 상태

모든 컴포넌트, 혹은 다수의 컴포넌트가 필요로 하는 상태를 말한다.

전역 상태 관리를 사용하면 props drilling으로 인한 복잡한 상황을 피할 수 있어 편리하지만, 전역 상태도 곧 상태이기에 이것이 업데이트되면 이 전역 상태를 구독하고 있는 모든 컴포넌트들이 리렌더링이 된다.

따라서 편리하다고 무작정 쓰기보다는 정말로 "전역 상태"로 관리해야하는 데이터인지에 대한 고려가 필요하다.

---

## 어떤 상태관리 라이브러리를 어떤 상황에서 사용해야 할까?

1. `redux`

   - redux-saga, redux-thunk, redux-devtools와 같은 추가 기능을 제공하는 라이브러리를 사용할 수 있다.
   - 작은 상태 하나를 변경하려고 해도, actions, reducer, type 등 보일러 플레이트 코드를 많이 작성해야 하는 번거로움이 있고, 작성하는 코드의 양이 많아진다.
   - 긴 역사를 자랑하는 만큼 안정성이 어느 정도 보장된다.

2. `mobx`

   - React 뿐만 아니라 Vanilla JS나 Angular, Vue와 같은 프레임워크에서도 사용 가능
   - 보일러 플레이트 코드 등 작성할 것이 많은 Redux에 비해 가볍다.
   - 클래스형 컴포넌트를 기준으로 만들어져 객체 지향 프로그래밍 방식으로 코드를 작성할 수 있다. 이 때문에 Mobx와 리액트의 함수형 컴포넌트의 Hooks를 함께 사용하면 오류가 발생할 수 있다.

3. `recoil`
   - React의 라이브러리가 아니기 때문에 React 내부 스케쥴러에 접근이 어려운 `mobx`, `redux`와 달리 Recoil을 만든 Facebook에서 발표한 리액트 전용 상태관리 라이브러리이다.
   - 동시성 모드와 suspense의 제공을 통해 렌더링을 인터럽트 가능하도록 만들어 최적의 UX를 제공한다.
     - 동시성 모드 제공 : React가 각 컴포넌트에서 실행되는 비동기 요청 등을 보고 판단하여 렌더링 우선 순위를 정해 렌더링 최적화를 하는 모드. 렌더링 될 준비가 완료되어야 렌더링을 시작한다.
     - Suspense: 컴포넌트가 렌더링 될 준비가 되지 않으면 렌더링을 하지 않고 suspense 상태로 둔다. 아래와 같이 fallback 속성을 전달하면 대신 렌더링 할 컴포넌트를 지정할 수 있다.

$\rightarrow$ npm 다운로드 추세를 보면 커뮤니티가 큰 redux, react에 최적화된 recoil의 사용빈도가 가장 높은데 redux가 보일러플레이트에도 불구하고 devtools를 제공하는 장점이 있기에, 상태관리가 복잡한 큰 규모의 프로젝트에서 사용하면 좋을 것 같다.

$\rightarrow$ 또한 recoil은 Redux MobX등의 서드파티 라이브러리와 다르게 오직 리액트 만을 위해서 생겨난 라이브러리이기에, 아직은 redux에 비해 커뮤니티가 작지만, 페이스북이 직접 개발하기 때문에 앞으로 점점 더 리액트스러운 전역 상태 관리를 위해 사용 빈도가 올라갈 것으로 보인다. (개인적으로는 devtools만 제공한다면 recoil이 우위를 점하지 않을까 싶기도 하다.)
